# Godocs

**Godocs** is a package that helps in the process of **building Godot documentation** by **automating the conversion** of **Godot's XML docs** to any **other format** implemented.

## ü§î How to Use

To use this package, you'll need the **XML files generated by Godot's** `doctool` utility, using a **command** similar to the **below**:

``` sh
godot --headless --doctool <output-dir> --no-docbase --gdscript-docs res://<input-dir>
```

According to some tests, **sometimes** Godot's `doctool` **doesn't work** with projects that haven't been yet opened in the **Godot editor**, so make sure to **try opening yours** if the command isn't working.

> üí° **NOTE**: In this documentation, when you find stuff in **diamond brackets** (like this: `<name>`), generally speaking, it means that it should be **substituted by something else**, which is explained by its name.

With the **XML files** generated by the `doctool`, `godocs` can be used to **generate** output **documentation files**.

**By itself**, though, **Godocs isn't capable of generating documentation**. That's because **to realize its full potential**, you also need to **install a constructor extension**. By default, the `godocs-jinja` plugin was created to allow the **construction of documentation through the use of Jinja2**.

> üí° **NOTE**: Initially, both `godocs` and `godocs-jinja` were only **one package**, but the decision of **separating both** was made in order to **allow the creation of alternative constructors in the future** that would give users the liberty of **not using Jinja2** if they didn't want to.<br>
Also, the separation was made to **make the development more manageable** and the addition of **future constructors more modular**, **not requiring users to install constructors they don't really need**.

Having said that, if you have `godocs-jinja` **installed**, you can **generate your docs** in the **formats available**. In the moment, **only RST generation is implemented**, which can be **used by other generators** like [Python's Sphinx](https://www.sphinx-doc.org/en/master/) to build **outputs to other media**, like **HTML pages**.

Here's an example of how to **generate RST documentation**, having both `godocs` and `godocs-jinja` installed:

``` sh
godocs construct jinja <input-dir> <output-dir>
```

## üì• Installation

To start using the **Godocs CLI**, you can **install** both the **main package** and the **Jinja constructor** through **PIP**.

Here's the commands:

``` sh
# To install the main CLI:
pip install godocs

# To install the Jinja2 based constructor:
pip install godocs-jinja
```

> üí° **HINT**: Depending on your needs, it may be useful to install packages in a **virtual environment**, as to not pollute your global env. Sometimes you may want to install stuff globally, though, it really depends.<br>
Generally speaking, I'd recommend **installing globally** if you're in a **CI/ CD runner**, for example, and installing in an **environment** if you're in your **local computer testing** out in a single repository.

If you desire to **isolate installation** in a `venv`, you should previously have run these **commands**:

``` sh
# To create a venv in a .venv folder:
python -m venv .venv

# To activate the created venv on Windows:
.venv/Scripts/activate
# Or, on Unix systems or Git Bash, for example:
source .venv/Scripts/activate
```

## üéõÔ∏è Commands

The **Godocs CLI** exposes some commands via the `godocs` entrypoint (if you installed in a **virtual environment**, make sure to have it **activated** before effectively using the program).

**Without** any **constructor plugin**, the only command available is the `construct`, which serves as the **main documentation generator**. That command doesn't do anything by itself, though, needing **at least one extension** to come into action.

If you installed the `godocs-jinja` plugin, like recommended, then you get to use the `jinja` subcommand as your **constructor**.

Down below are some quick **examples** of how to use `godocs` with `godocs-jinja` to **generate documentation**.

If you want a more **in depth overview** of the arguments, commands, and options available, you can always use the `-h` / `--help` option with **any command**.

Also, if you want **more details** on `godocs-jinja` concepts, like **models**, **templates**, **filters** and **builders**, you can read more about them in its **repository** in this [link](https://github.com/godocs-godot/godocs-jinja).

``` sh
# Generates documentation based on the XML in the input-dir inside the output-dir, in the RST language.
godocs construct jinja <input-dir> <output-dir>

# Generates documentation based on the XML from the input-dir inside the output-dir, in the RST language, translating the syntax of any text within it using the custom translator in the translator-path.
godocs construct jinja --translator <translator-path> <input-dir> <output-dir>

# Generates documentation based on the XML from the input-dir inside the output-dir, using the model specified by md-model, with the md file suffix, translating the syntax of any text within the XML using the custom translator in the md-translator path.
godocs construct jinja --translator <md-translator> --format md --model <md-model> <input-dir> <output-dir>
```

## Installing dependencies

It's **recommended** to be **inside a virtual environment** before **installing the project dependencies**, as to **not clutter your global dependencies**.

To **create a virtual environment in the project folder** using Python's built-in `venv` module, run the following command:

``` sh
python -m venv .venv
```

This will create a **venv** inside the `.venv` folder, which can then be activated executing:

``` sh
.venv/Scripts/activate
```

Now, the installations can be made with either command:

``` sh
# For production only dependencies:
pip install .

# For development dependencies:
pip install .[dev]

# For peer dependencies:
pip install .[peer]
```

The **dependencies** installed are **listed** in the `pyproject.toml` under the `[project.dependencies]` field - for general **required dependencies** - and the `[project.optional-dependencies.dev]` field - for **development dependencies** (which include test and build stuff).

**Peer dependencies** are can be **found** under the `[project.optional-dependencies.peer]` field. `Jinja2` is considered a **peer dependency** for this library as you can create **your own** `Constructors` that **don't** necessarily **need that package**, making its installation **unecessary** in those cases.

If you want to use the **default** `Constructor` (most of the cases, probably), you can just **install** the **peer dependencies** with the **command** shown **above**.

## Building

### For development

In a **dev context**, it's easier to **build** the project with the **editable option**, so **changes are automatically reflected in the current environment**.

To do so, run the following command:

``` sh
pip install --editable .
```

### For production

To **build the project** for production, the `build` **dependency is needed**, which is specified in the **dev dependencies** from `pyproject.toml`.

With that **dependency installed** (through the **installation of the dev dependencies**, or its manual installation), the following command can be used:

``` sh
python -m build .
```

This will use the `setuptools` **build backend** in an **isolated temporary environment** to **create the distributables**.

When executed, **there should be** a `dist` folder with a `.tar.gz` archive and a `.whl` build.

## Deploying
To deploy this package, use the following command:

``` sh
python -m twine upload dist/*
```

## Extending
Godocs strives to be **open for configurations and extensions** from users, that's why a **plugin system** is implemented.

Currently, users can add to the application both through script plugins and plugin packages by extending the `Plugin` class. Users can add **custom constructors** as well as **custom CLI commands** to receive the configurations for those constructors, or any other modifications they want.

Scripts that define plugins should **expose** a `Plugin` class, that implements the base `godocs.plugin.Plugin` with its main `register` method defining what happens when this plugin is used.

Down below is a snippet showing an example of a **custom command plugin**, that adds a **constructor option** to the CLI, and, when chosen prints `"[Godocs Construct Custom]"` and the args `Namespace` received from argsparse:

``` python
from argparse import Namespace
from godocs.plugin import Plugin as BasePlugin
from godocs.cli import AppCommand


class Plugin(BasePlugin):

    def exec(self, args: Namespace):
        print("[Godocs Construct Custom]")
        print(args)

    def register(self, app: AppCommand):
        construct = app.commands["construct"]

        construct_subparsers = construct.subparsers

        if construct_subparsers is None:
            raise

        custom_parser = construct_subparsers.add_parser(
            "custom", help="Construct docs using a custom constructor.", parents=[construct.subparsers_parent])

        custom_parser.set_defaults(func=self.exec)

```

In order to **apply this plugin** to the **CLI**, the `-p` or `--plugin` **option** can be passed with the **path to this script** in the `godocs` program.

In order to make plugins more easily shareable, plugin packages are also supported by using entry points. Here's an example of how the `godocs-jinja` plugin exposes itself as a plugin so `godocs` can find and register it:

``` python
# pyproject.toml
[project.entry-points."godocs.plugins"]
jinja = "godocs_jinja.main:JinjaPlugin"
```
